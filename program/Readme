# Example Code

library(TMB)
library(statmod)
library(mvtnorm)
library(tidyverse)

compile("leslie.cpp")
dyn.load(dynlib("leslie"))

## data

dat <- read.csv("squid.csv")
dat <- dat %>% mutate(Cat=Catch/Mass, CR=CPUE/Mass)
TC <- dat %>% group_by(Year) %>% summarize(TC=sum(Cat))
res <- lapply(1987:2000, function(i) lm(CR~cumsum(Cat),data=subset(dat, Year==i)))
lm_res <- sapply(1:length(res), function(i) c(-res[[i]]$coef[2], -res[[i]]$coef[1]/res[[i]]$coef[2]))
lm_res <- rbind(lm_res, TC$TC)
lm_res <- as.data.frame(t(lm_res))
names(lm_res) <- c("q","N0","Catch")
rownames(lm_res) <- 1987:2000

source("leslie.r")
source("sim.r")

res2 <- leslie(dat, model=2, do_compile=FALSE, pre_process=FALSE)
